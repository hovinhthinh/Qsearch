<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>TabQs</title>
    <link href="/fontawesome_5.10.1/css/all.css" rel="stylesheet">
    <link href="/css/bootstrap_4.0.0.min.css" rel="stylesheet">
    <link href="css/local.css" rel="stylesheet">
    <link href="/css/bootstrap-multiselect.css" rel="stylesheet">
    <link href="/css/bootstrap4-toggle_3.6.1.min.css" rel="stylesheet">
</head>

<body>
<script src="/js/jquery_3.2.1.min.js"></script>
<script src="/js/jquery.cookie_1.4.1.js"></script>
<script src="/js/popper_1.12.9.min.js"></script>
<script src="/js/bootstrap_4.0.0.min.js"></script>
<script src="/js/nanobar_0.4.2.min.js"></script>
<script src="/js/bootstrap-multiselect.js"></script>
<script src="/js/particles_2.0.0.min.js"></script>
<script src="/js/bootstrap4-toggle_3.6.1.min.js"></script>

<div id="particles-bg"></div>

<div class="container col-xs-12 col-sm-12 col-md-7 col-lg-5 centered">
    <div class="container col-xs-12 col-sm-12 col-md-7 col-lg-7">
        <img src="img/logo2.png" class="img-fluid mb-3" alt="logo">
    </div>
    <div class="input-group">
        <button data-animation="true" data-placement="top" data-trigger="hover" data-html="true"
                data-content="Click here to change search mode!" data-original-title="" title="" id="change-mode"
                class="btn"><i class="fas fa-sync-alt"></i></button>
        <input autocomplete="off" hidden type="text" class="form-control" placeholder="type" id="type">
        <input autocomplete="off" hidden type="text" class="form-control" placeholder="context" id="context">
        <input autocomplete="off" hidden type="text" class="form-control" placeholder="quantity" id="quantity">
        <input autocomplete="off" type="text" class="form-control" placeholder="what do you want to search for?"
               id="full">
        <button type="button" class="btn btn-primary" id="search">Search</button>
    </div>
    <div class="mt-3"><a href="#" class="sample-query">skyscrapers higher than 1000 feet</a></div>
    <div><a href="#" class="sample-query">technology companies with more than 10 billion Euro annual profit</a></div>
    <!--    <div><a href="#" class="sample-query">footballers with transfer cost more than 50 million euros</a></div>-->
    <div><a href="#" class="sample-query">which hybrid cars have range on battery more than 50 km?</a></div>
    <!--    <div><a href="#" class="sample-query">celebrities having over 5m followers on Instagram</a></div>-->
    <div><a href="#" class="sample-query">sport utility vehicles with engine power above 150 horsepower</a></div>
    <div><a href="#" class="sample-query">sprinters who ran 100 meter in less than 10 seconds</a></div>
    <!--    <div><a href="#" class="sample-query">mobile phones with battery capacity higher than 2000 mAh</a></div>-->
    <div><a href="#" class="sample-query">computer games with number of players more than 100 million </a></div>
</div>
<footer class="footer fixed-bottom">
    <table align="center">
        <tr>
            <td valign="middle" style="padding-top: 15px">
                <div class="container mb-3">
                    &copy; 2020
                    <a href="https://www.mpi-inf.mpg.de/departments/databases-and-information-systems/"
                       referrerpolicy="no-referrer">Database
                        & Information Systems Group</a>, Max Planck Institute for Informatics
                    &nbsp;|&nbsp;<a href="https://imprint.mpi-klsb.mpg.de/inf/qsearch.mpi-inf.mpg.de"
                                    referrerpolicy="no-referrer">
                    Impressum</a>&nbsp;|&nbsp;<a
                        href="https://data-protection.mpi-klsb.mpg.de/inf/qsearch.mpi-inf.mpg.de"
                        referrerpolicy="no-referrer">
                    Datenschutzhinweis</a>
                </div>
            </td>
            <td style="width: 50px"></td>
            <td>
                <img style="height: 60px" src="/img/mpi.png" class="img-fluid" alt="logo">
            </td>
        </tr>
    </table>
</footer>

<div class="card float-right" style="margin-top: 15px; margin-right: 15px; border-color: #B8D2FA;" id="settings">
</div>

<script>
    $('#settings').html($.ajax({
        type: "GET",
        url: "settings.html",
        async: false
    }).responseText);
</script>

<script src="js/local.js"></script>

<script>
    var nanobar = new Nanobar();
    document.getElementById('nanobarcss').innerHTML += '.nanobar .bar { background: #3c78d8;  box-shadow: 0 0 10px #3c78d8; border-radius: 4px; }';

    $("#full").focus();

    function search() {
        var params = {
            corpus: JSON.stringify($("#corpus").val()),
            ntop: $("#ntop").val(),
            rescore: $("#rescore").is(':checked').toString(),
            'linking-threshold': $("#linking-threshold").val()
        };
        if ($.cookie('part_search_table') != "1") {
            if ($("#full").val().trim() == "") {
                return;
            }
            params.full = $("#full").val();
        } else {
            if ($("#type").val().trim() == "" || $("#quantity").val().trim() == "") {
                return;
            }
            params.type = $("#type").val();
            params.context = $("#context").val();
            params.quantity = $("#quantity").val();
        }

        $("#search").attr('disabled', 'disabled').html("Searching <i class=\"fas fa-spinner fa-spin\"></i>");
        $("#change-mode").attr('disabled', 'disabled');
        $("#full").attr('disabled', 'disabled');
        $("#type").attr('disabled', 'disabled');
        $("#context").attr('disabled', 'disabled');
        $("#quantity").attr('disabled', 'disabled');

        var startRescore = false;
        if ("WebSocket" in window) {
            var ws = new WebSocket(location.protocol.replace("http", "ws") + "//" + location.host + "/search_socket_table");
            ws.onopen = function () {
                ws.send(JSON.stringify(params));
            };

            ws.onmessage = function (evt) {
                var msg = evt.data;
                var data = JSON.parse(msg);
                if ("progress" in data) {
                    nanobar.go(data["progress"]);
                } else if ("rescore-progress" in data) {
                    nanobar.go(data["rescore-progress"]);
                    if (!startRescore) {
                        $("#search").html("Rescoring <i class=\"fas fa-spinner fa-spin\"></i>");
                        startRescore = true;
                    }
                } else {
                    window.location.replace("/table/result.html?s=" + data.s + "&q=" + encodeURIComponent(btoa(encodeURIComponent(JSON.stringify(params)))));
                }
            };
            ws.onerror = function () {
                alert("An error occurred.");
            };
            ws.onclose = function () {
                $("#search").removeAttr('disabled').html("Search");
                $("#change-mode").removeAttr('disabled');
                $("#full").removeAttr('disabled');
                $("#type").removeAttr('disabled');
                $("#context").removeAttr('disabled');
                $("#quantity").removeAttr('disabled');
            };
        } else {
            $.ajax({
                type: "GET",
                url: "/search_table",
                data: params,
                contentType: 'application/json; charset=utf-8',
                dataType: "json",
                success: function (data) {
                    window.location.replace("/table/result.html?s=" + data.s + "&q=" + encodeURIComponent(btoa(encodeURIComponent(JSON.stringify(params)))));
                },
                error: function () {
                    alert("An error occurred.");
                },
                complete: function () {
                    $("#search").removeAttr('disabled').html("Search");
                    $("#change-mode").removeAttr('disabled');
                    $("#full").removeAttr('disabled');
                    $("#type").removeAttr('disabled');
                    $("#context").removeAttr('disabled');
                    $("#quantity").removeAttr('disabled');
                }
            });
        }
    }

    $("#search").click(search);

    $(".sample-query").each(function (index) {
        $(this).click(function () {
            if ($.cookie('part_search_table') == "1") {
                changeSearchMode();
            }
            if ($("#full")[0].hasAttribute('disabled')) {
                return;
            }
            $("#full").val($(this).html());
            $("#search").click();
        });
    });

    autocomplete(document.getElementById("type"));
    autocomplete(document.getElementById("full"));

    $(document).ready(function () {
        $('#change-mode').each(function () {
            var current = this;
            var popoverElement = $(current).popover('show')
                .data('bs.popover').getTipElement();
            $(popoverElement).addClass('popover-converted-quantity');
        });
    });

    // use part-search mode.
    if ($.cookie('part_search_table') == null) {
        // changeSearchMode();
    }

    particlesJS.load('particles-bg', '/js/particles.json');
</script>

</body>
</html>
