<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Qsearch</title>
    <link href="fontawesome_5.10.1/css/all.css" rel="stylesheet" crossorigin="anonymous">
    <link href="css/bootstrap_4.0.0.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="css/local.css" rel="stylesheet" crossorigin="anonymous">
    <link href="css/bootstrap-multiselect.css" rel="stylesheet" crossorigin="anonymous">
</head>

<body>
<script src="js/jquery_3.2.1.min.js" crossorigin="anonymous"></script>
<script src="js/jquery.cookie_1.4.1.js" crossorigin="anonymous"></script>
<script src="js/popper_1.12.9.min.js" crossorigin="anonymous"></script>
<script src="js/bootstrap_4.0.0.min.js" crossorigin="anonymous"></script>
<script src="js/nanobar_0.4.2.min.js" crossorigin="anonymous"></script>
<script src="js/bootstrap-multiselect.js" crossorigin="anonymous"></script>

<div class="container col-xs-12 col-sm-12 col-md-7 col-lg-5 centered">
    <div class="container col-xs-12 col-sm-12 col-md-7 col-lg-7">
        <img src="img/logo.png" class="img-fluid mb-3" alt="logo">
    </div>
    <div class="input-group">
        <input type="text" class="form-control" placeholder="what do you want to search for?" id="full">
        <button type="button" class="btn btn-success" id="search">Search</button>
    </div>
    <div class="mt-3"><a href="#" class="sample-query">skyscrapers with more than 1000 feet in height</a></div>
    <!--    <div><a href="#" class="sample-query">footballers with transfer cost more than 50 million euros</a></div>-->
    <div><a href="#" class="sample-query">which hybrid cars have range on battery above 50 km?</a></div>
    <!--    <div><a href="#" class="sample-query">celebrities having over 5m followers on Instagram</a></div>-->
    <div><a href="#" class="sample-query">tennis players that won more than 1000 matches</a></div>
    <div><a href="#" class="sample-query">technology companies having at least 1 billion usd annual profit</a></div>
    <div><a href="#" class="sample-query">mobile phones containing battery with capacity higher than 2000 mAh</a></div>
</div>
<footer class="footer fixed-bottom">
    <table align="center">
        <tr>
            <td valign="middle" style="padding-top: 15px">
                <div class="container mb-3">
                    &copy; 2019
                    <a href="https://www.mpi-inf.mpg.de/departments/databases-and-information-systems/"
                       referrerpolicy="no-referrer">Database
                        & Information Systems Group</a>, Max Planck Institute for Informatics
                    &nbsp;|&nbsp;<a href="https://imprint.mpi-klsb.mpg.de/inf/qsearch.mpi-inf.mpg.de"
                                    referrerpolicy="no-referrer">
                    Impressum</a>&nbsp;|&nbsp;<a
                        href="https://data-protection.mpi-klsb.mpg.de/inf/qsearch.mpi-inf.mpg.de"
                        referrerpolicy="no-referrer">
                    Datenschutzhinweis</a>
                </div>
            </td>
            <td style="width: 50px"></td>
            <td>
                <img style="height: 60px" src="img/mpi.png" class="img-fluid" alt="logo">
            </td>
        </tr>
    </table>
</footer>

<div class="card float-right" style="margin-top: 15px; margin-right: 15px; border-color: #d6e9c6;">
    <div class="card-header" style="background-color: #dff0d8; border-color: #d6e9c6">
        <a id='setting-toggle' data-toggle="collapse" href="#setting-body" style="text-decoration: none;">
            <span style="color: #3c763d">
                <strong>Settings</strong>&nbsp;&nbsp;<i class="float-right fa fa-chevron-up"></i>
            </span>
        </a>
    </div>
    <div id="setting-body" class="collapse show">
        <div class="card-body">
            <table>
                <tr>
                    <td>Input corpus:&nbsp;</td>
                    <td>
                        <select class="custom-select" multiple id="corpus">
                            <option value="STICS" selected>Stics</option>
                            <option value="NYT" selected>New York Times</option>
                            <option value="WIKIPEDIA" selected>Wikipedia</option>
                        </select>
                    </td>
                    <td>&nbsp;&nbsp;nTop:&nbsp;</td>
                    <td>
                        <select class="custom-select" id="ntop">
                            <option value="10">10</option>
                            <option value="20" selected>20</option>
                            <option value="30">30</option>
                            <option value="40">40</option>
                            <option value="50">50</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td style="padding-top: 5px;">Ranking model:&nbsp;</td>
                    <td style="padding-top: 5px;" colspan="3">
                        <select class="custom-select" id="model">
                            <option value="EMBEDDING" selected>Context Embedding Distance (ced)</option>
                            <option value="KL">Kullback-Leibler Divergence (KL)</option>
                        </select>
                    </td>
                </tr>
                <tr id="alpha-option">
                    <td style="padding-top: 10px;">Penalty (&alpha;):&nbsp;</td>
                    <td style="padding-top: 10px;" colspan="3">
                        <table style="width: 100%">
                            <tr>
                                <td><input type="range" value="3" class="slider" step="0.1" min="0" max="10" id="alpha"
                                           oninput="$('#alpha-value').text(parseFloat(this.value).toFixed(1));"></td>
                                <td id="alpha-value" align="right" style="width: 2.5em">3.0</td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr id="lambda-option">
                    <td style="padding-top: 10px;">Smoothing (&lambda;):&nbsp;</td>
                    <td style="padding-top: 10px;" colspan="3">
                        <table style="width: 100%">
                            <tr>
                                <td><input type="range" value="0.1" class="slider" step="0.1" min="0" max="1"
                                           id="lambda"
                                           oninput="$('#lambda-value').text(parseFloat(this.value).toFixed(1));"></td>
                                <td id="lambda-value" align="right" style="width: 2.5em">0.1</td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>
<script src="js/local.js" crossorigin="anonymous"></script>

<script>
    var nanobar = new Nanobar();
    document.getElementById('nanobarcss').innerHTML += '.nanobar .bar { background: #6aa94e; }';

    function search() {
        if ($("#full").val().trim() == "") {
            return;
        }
        var params = {
            full: $("#full").val(),
            corpus: JSON.stringify($("#corpus").val()),
            model: $("#model").val(),
            lambda: $("#lambda").val(),
            alpha: $("#alpha").val(),
            ntop: $("#ntop").val()
        };
        if ("WebSocket" in window) {
            $("#search").attr('disabled', 'disabled').html("Searching <i class=\"fas fa-spinner fa-spin\"></i>");
            $("#full").attr('disabled', 'disabled');

            var ws = new WebSocket(location.protocol.replace("http", "ws") + "//" + location.host + "/search_socket");
            ws.onopen = function () {
                ws.send(JSON.stringify(params));
            };

            ws.onmessage = function (evt) {
                var msg = evt.data;
                var data = JSON.parse(msg);
                if ("progress" in data) {
                    nanobar.go(data["progress"]);
                } else {
                    window.location.replace("/result.html?d=" + encodeURIComponent(btoa(encodeURIComponent(msg))) + "&q=" + encodeURIComponent(btoa(encodeURIComponent($("#full").val()))));
                }
            };
            ws.onerror = function () {
                alert("An error occurred.");
            };
            ws.onclose = function () {
                $("#search").removeAttr('disabled').html("Search");
                $("#full").removeAttr('disabled')
            };
        } else {
            $.ajax({
                type: "GET",
                url: "/search/",
                data: params,
                contentType: 'application/json; charset=utf-8',
                dataType: "json",
                beforeSend: function () {
                    $("#search").attr('disabled', 'disabled').html("Searching <i class=\"fas fa-spinner fa-spin\"></i>");
                    $("#full").attr('disabled', 'disabled');
                },
                success: function (data) {
                    window.location.replace("/result.html?d=" + encodeURIComponent(btoa(encodeURIComponent(JSON.stringify(data)))) + "&q=" + encodeURIComponent(btoa(encodeURIComponent($("#full").val()))));
                },
                error: function () {
                    alert("An error occurred.");
                },
                complete: function () {
                    $("#search").removeAttr('disabled').html("Search");
                    $("#full").removeAttr('disabled')
                }
            });
        }
    }

    $("#search").click(search);
    $("#full").focus();

    $(".sample-query").each(function (index) {
        $(this).click(function () {
            if ($("#full")[0].hasAttribute('disabled')) {
                return;
            }
            $("#full").val($(this).html());
            $("#search").click();
        });
    });

    autocomplete(document.getElementById("full"));
</script>

</body>
</html>
